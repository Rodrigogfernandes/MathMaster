<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathMaster - Cadastro e Login</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/login.css">

</head>

<body>
    <header>
        <div class="container header-content">
            <a href="#" class="logo">
                <div class="logo-icon">M</div>
                <span>MathMaster</span>
            </a>
            <nav>

            </nav>
        </div>
    </header>

    <div class="container">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-image">
                    <div class="auth-illustration">üßÆ</div>
                    <h2>Bem-vindo ao MathMaster</h2>
                    <p>A plataforma que torna o aprendizado de matem√°tica divertido e eficiente!</p>

                    <div class="auth-benefits">
                        <div class="benefit-item">
                            <div class="benefit-icon">üèÜ</div>
                            <div class="benefit-text">Aprenda com gamifica√ß√£o e conquiste medalhas</div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">üìä</div>
                            <div class="benefit-text">Acompanhe seu progresso e evolu√ß√£o</div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">üéØ</div>
                            <div class="benefit-text">Conte√∫do personalizado para seu n√≠vel</div>
                        </div>
                    </div>
                </div>

                <div class="auth-forms">
                    <div class="tabs">
                        <div class="tab active" id="login-tab" onclick="switchTab('login')">Login</div>
                        <div class="tab" id="register-tab" onclick="switchTab('register')">Cadastro</div>
                    </div>

                    <div class="success-message" id="successMessage">
                        <p>Cadastro realizado com sucesso! Voc√™ pode fazer login agora.</p>
                    </div>

                    <!-- Login Form -->
                    <div class="form-content active" id="login-form">
                        <form onsubmit="login(event)">
                            <div class="form-group">
                                <label for="loginEmail">Email</label>
                                <input type="email" id="loginEmail" class="form-control" placeholder="Seu email"
                                    required>
                                <div class="form-error" id="login-email-error">Email inv√°lido ou n√£o cadastrado</div>
                            </div>

                            <div class="form-group">
                                <label for="loginPassword">Senha</label>
                                <div class="password-input-container">
                                    <input type="password" id="loginPassword" class="form-control"
                                        placeholder="Sua senha" required>
                                    <button type="button" class="toggle-password"
                                        onclick="togglePasswordVisibility('loginPassword')">üëÅÔ∏è</button>
                                </div>
                                <div class="password-reset">
                                    <a href="recuperar-senha.html">Esqueceu a senha?</a>
                                </div>
                                <div class="form-error" id="login-password-error">Senha incorreta</div>
                            </div>

                            <div class="form-options">
                                <div>
                                    <label>
                                        <input type="checkbox" id="remember-me"> Lembrar de mim
                                    </label>
                                </div>
                            </div>

                            <div class="form-footer">
                                <button type="submit" class="btn">Entrar</button>
                            </div>

                            <div class="social-login">
                                <p>Ou entre com</p>
                                <div class="social-buttons">
                                    <button type="button" class="social-btn google">G</button>
                                    <button type="button" class="social-btn facebook">f</button>
                                    <button type="button" class="social-btn apple">üçé</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Register Form -->
                    <div class="form-content" id="register-form">
                        <form onsubmit="registerUser(event)">
                            <div class="form-group">
                                <label for="register-name">Nome Completo</label>
                                <input type="text" id="register-name" class="form-control"
                                    placeholder="Seu nome completo" required>
                                <div class="form-error" id="register-name-error">Por favor, informe seu nome completo
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="register-email">Email</label>
                                <input type="email" id="register-email" class="form-control"
                                    placeholder="Seu melhor email" required>
                                <div class="form-error" id="register-email-error">Email inv√°lido ou j√° cadastrado</div>
                            </div>

                            <div class="form-group">
                                <label for="register-password">Senha</label>
                                <div class="password-input-container">
                                    <input type="password" id="register-password" class="form-control"
                                        placeholder="Crie uma senha forte" required onkeyup="checkPasswordStrength()">
                                    <button type="button" class="toggle-password"
                                        onclick="togglePasswordVisibility('register-password')">üëÅÔ∏è</button>
                                </div>
                                <div class="password-strength">
                                    <div class="password-strength-bar" id="password-strength-bar"></div>
                                </div>
                                <div class="password-tips">Dica: Use pelo menos 8 caracteres com letras mai√∫sculas,
                                    min√∫sculas, n√∫meros e s√≠mbolos.</div>
                                <div class="form-error" id="register-password-error">A senha deve ter pelo menos 8
                                    caracteres</div>
                            </div>

                            <div class="form-group">
                                <label for="register-confirm-password">Confirmar Senha</label>
                                <div class="password-input-container">
                                    <input type="password" id="register-confirm-password" class="form-control"
                                        placeholder="Confirme sua senha" required>
                                    <button type="button" class="toggle-password"
                                        onclick="togglePasswordVisibility('register-confirm-password')">üëÅÔ∏è</button>
                                </div>
                                <div class="form-error" id="register-confirm-password-error">As senhas n√£o coincidem
                                </div>
                            </div>

                            <div class="form-options">
                                <div>
                                    <label>
                                        <input type="checkbox" id="terms-and-conditions" required>
                                        Aceito os <a href="termos-de-uso.html">Termos e Condi√ß√µes</a>
                                    </label>
                                </div>
                            </div>

                            <div class="form-footer">
                                <button type="submit" class="btn">Cadastrar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="auth-features">
            <div class="auth-feature">
                <div class="feature-icon">üéØ</div>
                <h3>Aprenda no seu ritmo</h3>
                <p>Estude matem√°tica quando e onde quiser, com aulas interativas e personalizadas.</p>
            </div>
            <div class="auth-feature">
                <div class="feature-icon">üèÜ</div>
                <h3>Ganhe recompensas</h3>
                <p>Acumule moedas, desbloqueie conquistas e acompanhe seu progresso.</p>
            </div>
            <div class="auth-feature">
                <div class="feature-icon">üë•</div>
                <h3>Junte-se √† comunidade</h3>
                <p>Conecte-se com outros estudantes e compartilhe conhecimentos.</p>
            </div>

        </div>

    </div>

    <footer class="footer">
        <div class="container footer-content">
            <div class="copyright">
                &copy; 2025 MathMaster. Todos os direitos reservados.
            </div>
            <div class="footer-links">
                <ul>
                    <li><a href="termos-de-uso.html">Termos de Uso</a></li>
                    <li><a href="privacidade.html">Privacidade</a></li>
                    <li><a href="contato.html">Contato</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        // Fun√ß√£o para alternar entre as abas de login e cadastro
        function switchTab(tab) {
            // Remove a classe active de todas as abas e formul√°rios
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-content').forEach(f => f.classList.remove('active'));

            // Adiciona a classe active √† aba selecionada e ao formul√°rio correspondente
            document.getElementById(`${tab}-tab`).classList.add('active');
            document.getElementById(`${tab}-form`).classList.add('active');

            // Esconde a mensagem de sucesso ao mudar de aba
            document.getElementById('successMessage').classList.remove('show');
        }

        // Fun√ß√£o para alternar a visibilidade da senha
        function togglePasswordVisibility(inputId) {
            const passwordInput = document.getElementById(inputId);
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);

            // Altera o √≠cone do bot√£o (opcional)
            const button = passwordInput.nextElementSibling;
            button.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è';
        }

        // Fun√ß√£o para verificar a for√ßa da senha
        function checkPasswordStrength() {
            const password = document.getElementById('register-password').value;
            const strengthBar = document.getElementById('password-strength-bar');

            // Remove todas as classes anteriores
            strengthBar.classList.remove('weak', 'medium', 'strong');
            strengthBar.style.width = '0';

            if (password.length === 0) {
                return;
            }

            // Crit√©rios para verificar a for√ßa da senha
            const hasLowerCase = /[a-z]/.test(password);
            const hasUpperCase = /[A-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            const isLongEnough = password.length >= 8;

            // Calcular pontua√ß√£o
            let score = 0;
            if (hasLowerCase) score++;
            if (hasUpperCase) score++;
            if (hasNumber) score++;
            if (hasSpecialChar) score++;
            if (isLongEnough) score++;

            // Definir a for√ßa com base na pontua√ß√£o
            if (score <= 1) {
                strengthBar.classList.add('weak');
            } else if (score <= 3) {
                strengthBar.classList.add('medium');
            } else {
                strengthBar.classList.add('strong');
            }

            // Ajustar a largura da barra de for√ßa
            strengthBar.style.width = `${(score / 5) * 100}%`;
        }

        // Adicionar o event listener ao campo de senha
        document.addEventListener('DOMContentLoaded', () => {
            const passwordField = document.getElementById('register-password');
            if (passwordField) {
                passwordField.addEventListener('input', checkPasswordStrength);
            }
        });

        // Fun√ß√£o para validar o formul√°rio de login
        function login(event) {
            event.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            let isValid = true;

            // Resetar mensagens de erro
            document.getElementById('login-email-error').classList.remove('show');
            document.getElementById('login-password-error').classList.remove('show');

            // Validar email
            if (!validateEmail(email)) {
                document.getElementById('login-email-error').classList.add('show');
                isValid = false;
            }

            // Validar senha (simula√ß√£o - em produ√ß√£o, isso seria verificado no servidor)
            if (password.length < 6) {
                document.getElementById('login-password-error').classList.add('show');
                isValid = false;
            }

            // Se tudo estiver v√°lido, enviar o formul√°rio (simula√ß√£o)
            if (isValid) {
                console.log('Login bem-sucedido!');

                // Simula√ß√£o de resposta da API
                const mockApiResponse = {
                    success: true,
                    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMjM0NTYiLCJlbWFpbCI6InRlc3RlQGV4YW1wbGUuY29tIn0.abc123', // Token de exemplo
                    user: {
                        id: '123456',
                        name: 'Usu√°rio de Teste',
                        email: email
                    }
                };

                // Armazenar o token no localStorage
                localStorage.setItem('token', mockApiResponse.token);
                localStorage.setItem('userName', mockApiResponse.user.name);

                // Verificar se h√° um par√¢metro de redirecionamento na URL
                const urlParams = new URLSearchParams(window.location.search);
                const redirectPage = urlParams.get('redirect');

                if (redirectPage) {
                    // Redirecionar para a p√°gina solicitada
                    window.location.href = redirectPage;
                } else {
                    // Redirecionar para o dashboard por padr√£o
                    window.location.href = 'dashboard.html';
                }
            }
        }

        // Fun√ß√£o para validar o formul√°rio de cadastro
        function registerUser(event) {
            event.preventDefault();

            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const termsAccepted = document.getElementById('terms-and-conditions').checked;

            let isValid = true;

            // Resetar mensagens de erro
            document.getElementById('register-name-error').classList.remove('show');
            document.getElementById('register-email-error').classList.remove('show');
            document.getElementById('register-password-error').classList.remove('show');
            document.getElementById('register-confirm-password-error').classList.remove('show');

            // Validar nome
            if (name.trim().length < 3 || !name.includes(' ')) {
                document.getElementById('register-name-error').classList.add('show');
                isValid = false;
            }

            // Validar email
            if (!validateEmail(email)) {
                document.getElementById('register-email-error').classList.add('show');
                isValid = false;
            }

            // Validar senha
            if (password.length < 8) {
                document.getElementById('register-password-error').classList.add('show');
                isValid = false;
            }

            // Validar confirma√ß√£o de senha
            if (password !== confirmPassword) {
                document.getElementById('register-confirm-password-error').classList.add('show');
                isValid = false;
            }

            // Verificar termos e condi√ß√µes
            if (!termsAccepted) {
                alert('Por favor, aceite os termos e condi√ß√µes para continuar.');
                isValid = false;
            }

            // Se tudo estiver v√°lido, enviar o formul√°rio (simula√ß√£o)
            if (isValid) {
                console.log('Cadastro bem-sucedido!');
                // Aqui voc√™ adicionaria o c√≥digo para enviar os dados ao servidor

                // Mostrar mensagem de sucesso
                document.getElementById('successMessage').classList.add('show');

                // Limpar o formul√°rio
                document.getElementById('register-form').reset();

                // Mudar para a aba de login ap√≥s um breve delay
                setTimeout(() => {
                    switchTab('login');
                }, 3000);
            }
        }

        // Fun√ß√£o auxiliar para validar formato de email
        function validateEmail(email) {
            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }

        // Tema escuro
        function createThemeToggle() {
            const themeToggle = document.createElement('div');
            themeToggle.className = 'theme-toggle';
            themeToggle.innerHTML = 'üåì';
            themeToggle.style.position = 'fixed';
            themeToggle.style.bottom = '20px';
            themeToggle.style.left = '20px';
            themeToggle.style.backgroundColor = 'var(--primary)';
            themeToggle.style.color = 'var(--white)';
            themeToggle.style.width = '40px';
            themeToggle.style.height = '40px';
            themeToggle.style.borderRadius = '50%';
            themeToggle.style.display = 'flex';
            themeToggle.style.alignItems = 'center';
            themeToggle.style.justifyContent = 'center';
            themeToggle.style.cursor = 'pointer';
            themeToggle.style.boxShadow = 'var(--shadow)';
            themeToggle.style.zIndex = '50';

            themeToggle.addEventListener('click', toggleTheme);

            document.body.appendChild(themeToggle);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');

            if (document.body.classList.contains('dark-theme')) {
                document.documentElement.style.setProperty('--light-bg', '#1f2937');
                document.documentElement.style.setProperty('--white', '#374151');
                document.documentElement.style.setProperty('--text', '#e5e7eb');
                document.documentElement.style.setProperty('--primary', '#60a5fa');
            } else {
                document.documentElement.style.setProperty('--light-bg', '#f5f7fa');
                document.documentElement.style.setProperty('--white', '#ffffff');
                document.documentElement.style.setProperty('--text', '#333333');
                document.documentElement.style.setProperty('--primary', '#4a6fa5');
            }
        }

        // Criar o bot√£o de altern√¢ncia de tema quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function () {
            createThemeToggle();
        });

        // Inicializa√ß√£o quando o DOM estiver completamente carregado
        document.addEventListener('DOMContentLoaded', function () {
            // Verificar se h√° par√¢metros na URL para determinar qual aba mostrar inicialmente
            const urlParams = new URLSearchParams(window.location.search);
            const tabParam = urlParams.get('tab');

            if (tabParam === 'register') {
                switchTab('register');
            } else {
                switchTab('login');
            }

            // Adicionar listeners para anima√ß√µes de foco nos campos de formul√°rio (opcional)
            document.querySelectorAll('.form-control').forEach(input => {
                input.addEventListener('focus', function () {
                    this.parentElement.classList.add('focused');
                });

                input.addEventListener('blur', function () {
                    this.parentElement.classList.remove('focused');
                });
            });
        });

        // Adiciona valida√ß√£o em tempo real para a confirma√ß√£o de senha
        document.addEventListener('DOMContentLoaded', function () {
            const confirmPassword = document.getElementById('register-confirm-password');
            confirmPassword.addEventListener('keyup', function () {
                const password = document.getElementById('register-password').value;

                if (this.value !== password) {
                    document.getElementById('register-confirm-password-error').classList.add('show');
                } else {
                    document.getElementById('register-confirm-password-error').classList.remove('show');
                }
            });
        });
    </script>

    <script src="/js/api.js"></script>
    <script src="/js/notifications.js"></script>
    <script>
        // Verificar autentica√ß√£o
        document.addEventListener('DOMContentLoaded', function () {
            // Verificar se h√° um token no localStorage
            const token = localStorage.getItem('token');
            if (token) {
                // Fazer requisi√ß√£o para verificar o token
                fetch('/api/auth/me', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Usu√°rio autenticado, atualizar UI
                            updateUserInterface(data.data);

                            // Inicializar o sistema de notifica√ß√µes
                            if (window.NotificationSystem) {
                                window.NotificationSystem.init();
                            }
                        } else {
                            // Token inv√°lido, redirecionar para login em p√°ginas protegidas
                            if ('login.html' !== 'index.html' && 'login.html' !== 'login.html') {
                                window.location.href = '/login.html?redirect=login.html';
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao verificar autentica√ß√£o:', error);
                        // Redirecionar para login em caso de erro (para p√°ginas protegidas)
                        if ('login.html' !== 'index.html' && 'login.html' !== 'login.html') {
                            window.location.href = '/login.html?redirect=login.html';
                        }
                    });
            } else {
                // Sem token, redirecionar para login em p√°ginas protegidas
                if ('login.html' !== 'index.html' && 'login.html' !== 'login.html') {
                    window.location.href = '/login.html?redirect=login.html';
                }
            }
        });
    </script>
</body>
</html>