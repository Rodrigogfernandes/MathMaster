<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathMaster - Comunidade</title>
    <link rel="stylesheet" href="css/comunidade.css">
   
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <div class="logo-icon">M</div>
                <span>MathMaster</span>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">In√≠cio</a></li>
                    <li><a href="dashboard.html">M√≥dulos</a></li>
                    <li><a href="conquistas.html">Conquistas</a></li>
                    <li><a href="comunidade.html" class="active">Comunidade</a></li>
                </ul>
            </nav>
            <div class="user-profile">
                <div class="user-stats">
                    <div class="coins">
                        <span>ü™ô</span>
                        <span>0</span>
                    </div>
                </div>
                <div class="avatar" onclick="openProfileMenu()">A</div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="community-container">
            <div class="main-content">
                <div class="page-title">
                    <div class="page-title-icon">üë•</div>
                    <h1>Comunidade MathMaster</h1>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchTab(this, 'discussions')">Discuss√µes</div>
                    <div class="tab" onclick="switchTab(this, 'questions')">Perguntas</div>
                    <div class="tab" onclick="switchTab(this, 'challenges')">Desafios</div>
                </div>

                <div class="posts-container">
                    <div class="post">
                        <div class="post-header">
                            <div class="post-author-avatar">M</div>
                            <div class="post-info">
                                <div class="post-author">Maria Silva</div>
                                <div class="post-meta">
                                    <span>H√° 2 horas</span>
                                    <span>√Ålgebra</span>
                                </div>
                            </div>
                        </div>
                        <div class="post-content">
                            <p>Algu√©m pode me ajudar a entender melhor a fatora√ß√£o de polin√¥mios? Estou tendo dificuldades especialmente com casos em que h√° m√∫ltiplas vari√°veis.</p>
                            <div class="post-topics">
                                <span class="post-topic">√Ålgebra</span>
                                <span class="post-topic">Polin√¥mios</span>
                            </div>
                        </div>
                        <div class="post-actions">
                            <div class="post-action">
                                <span>üëç</span>
                                <span>12</span>
                            </div>
                            <div class="post-action">
                                <span>üí¨</span>
                                <span>8 respostas</span>
                            </div>
                            <div class="post-action">
                                <span>üîñ</span>
                                <span>Salvar</span>
                            </div>
                        </div>
                    </div>

                    <div class="post">
                        <div class="post-header">
                            <div class="post-author-avatar">J</div>
                            <div class="post-info">
                                <div class="post-author">Jo√£o Costa</div>
                                <div class="post-meta">
                                    <span>Ontem</span>
                                    <span>C√°lculo</span>
                                </div>
                            </div>
                        </div>
                        <div class="post-content">
                            <p>Compartilhando um m√©todo que me ajudou muito a memorizar as principais regras de deriva√ß√£o. Achei esse m√©todo visual super eficaz!</p>
                            <p>Basicamente, eu crio cart√µes mentais associando cada regra com uma imagem...</p>
                            <div class="post-topics">
                                <span class="post-topic">C√°lculo</span>
                                <span class="post-topic">Derivadas</span>
                                <span class="post-topic">Dicas de Estudo</span>
                            </div>
                        </div>
                        <div class="post-actions">
                            <div class="post-action">
                                <span>üëç</span>
                                <span>24</span>
                            </div>
                            <div class="post-action">
                                <span>üí¨</span>
                                <span>5 respostas</span>
                            </div>
                            <div class="post-action">
                                <span>üîñ</span>
                                <span>Salvar</span>
                            </div>
                        </div>
                    </div>

                    <div class="post">
                        <div class="post-header">
                            <div class="post-author-avatar">P</div>
                            <div class="post-info">
                                <div class="post-author">Prof. Carlos</div>
                                <div class="post-meta">
                                    <span>H√° 3 dias</span>
                                    <span>Geometria</span>
                                </div>
                            </div>
                        </div>
                        <div class="post-content">
                            <p>DESAFIO DA SEMANA: Provar que a soma dos √¢ngulos internos de um tri√¢ngulo √© sempre 180¬∞, usando apenas os axiomas de Euclides. Quem consegue?</p>
                            <div class="post-topics">
                                <span class="post-topic">Geometria</span>
                                <span class="post-topic">Desafio</span>
                            </div>
                        </div>
                        <div class="post-actions">
                            <div class="post-action">
                                <span>üëç</span>
                                <span>45</span>
                            </div>
                            <div class="post-action">
                                <span>üí¨</span>
                                <span>17 respostas</span>
                            </div>
                            <div class="post-action">
                                <span>üîñ</span>
                                <span>Salvar</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="new-post-form">
                    <div class="new-post-header">
                        <h3 class="form-title">Criar Nova Publica√ß√£o</h3>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control" placeholder="O que voc√™ gostaria de compartilhar ou perguntar?"></textarea>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Adicionar t√≥picos (separados por v√≠rgula)">
                    </div>
                    <div class="form-actions">
                        <button class="btn" onclick="createNewPost()">Publicar</button>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="sidebar-widget">
                    <h3>T√≥picos em Alta</h3>
                    <div class="trending-topics-list">
                        <div class="topic-item">
                            <div class="topic-icon">‚à´</div>
                            <div class="topic-info">
                                <div>Integrais</div>
                                <div>42 discuss√µes</div>
                            </div>
                        </div>
                        <div class="topic-item">
                            <div class="topic-icon">œÄ</div>
                            <div class="topic-info">
                                <div>Trigonometria</div>
                                <div>36 discuss√µes</div>
                            </div>
                        </div>
                        <div class="topic-item">
                            <div class="topic-icon">ùúé</div>
                            <div class="topic-info">
                                <div>Estat√≠stica</div>
                                <div>28 discuss√µes</div>
                            </div>
                        </div>
                        <div class="topic-item">
                            <div class="topic-icon">x¬≤</div>
                            <div class="topic-info">
                                <div>Equa√ß√µes Quadr√°ticas</div>
                                <div>23 discuss√µes</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-widget">
                    <h3>Usu√°rios Ativos</h3>
                    <div class="active-users-list">
                        <div class="user-item">
                            <div class="user-avatar">M</div>
                            <div class="user-info">
                                <div class="user-name">Maria Silva</div>
                                <div class="user-level">N√≠vel 28 ‚Ä¢ Especialista em √Ålgebra</div>
                            </div>
                        </div>
                        <div class="user-item">
                            <div class="user-avatar">P</div>
                            <div class="user-info">
                                <div class="user-name">Prof. Carlos</div>
                                <div class="user-level">N√≠vel 45 ‚Ä¢ Mentor</div>
                            </div>
                        </div>
                        <div class="user-item">
                            <div class="user-avatar">J</div>
                            <div class="user-info">
                                <div class="user-name">Jo√£o Costa</div>
                                <div class="user-level">N√≠vel 32 ‚Ä¢ Especialista em C√°lculo</div>
                            </div>
                        </div>
                        <div class="user-item">
                            <div class="user-avatar">L</div>
                            <div class="user-info">
                                <div class="user-name">Luiza Mendes</div>
                                <div class="user-level">N√≠vel 26 ‚Ä¢ Especialista em Geometria</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-widget">
                    <h3>Eventos da Comunidade</h3>
                    <div class="community-events">
                        <div class="event-item">
                            <div class="event-date">
                                <div class="event-day">15</div>
                                <div class="event-month">MAI</div>
                            </div>
                            <div class="event-info">
                                <div class="event-title">Olimp√≠ada de Matem√°tica</div>
                                <div class="event-description">Competi√ß√£o online com pr√™mios para os vencedores</div>
                            </div>
                        </div>
                        <div class="event-item">
                            <div class="event-date">
                                <div class="event-day">22</div>
                                <div class="event-month">MAI</div>
                            </div>
                            <div class="event-info">
                                <div class="event-title">Webinar: Matem√°tica na Pr√°tica</div>
                                <div class="event-description">Aplica√ß√µes da matem√°tica no dia a dia</div>
                            </div>
                        </div>
                        <div class="event-item">
                            <div class="event-date">
                                <div class="event-day">03</div>
                                <div class="event-month">JUN</div>
                            </div>
                            <div class="event-info">
                                <div class="event-title">Grupo de Estudos: C√°lculo III</div>
                                <div class="event-description">Encontro semanal para estudar juntos</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Login R√°pido -->
    <div class="quick-login-modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login R√°pido</h2>
                <span class="close-modal" onclick="closeLoginModal()">√ó</span>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="Seu email">
            </div>
            <div class="form-group">
                <label for="password">Senha</label>
                <input type="password" id="password" placeholder="Sua senha">
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeLoginModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="quickLogin()">Entrar</button>
            </div>
            <p style="margin-top: 15px; text-align: center;">
                <a href="login.html" style="color: var(--primary); text-decoration: none;">
                    Ir para p√°gina de login completa
                </a>
            </p>
        </div>
    </div>
    
    <script src="api.js"></script>
    <script src="components/notifications.js"></script>
    <script>
        // --------- Fun√ß√µes utilit√°rias ---------
        function formatTimeAgo(date) {
            const now = new Date();
            const past = new Date(date);
            const diff = Math.floor((now - past) / 1000);

            if (diff < 60) return 'agora mesmo';
            if (diff < 3600) return `${Math.floor(diff / 60)} min atr√°s`;
            if (diff < 86400) return `${Math.floor(diff / 3600)} h atr√°s`;
            if (diff < 2592000) return `${Math.floor(diff / 86400)} dias atr√°s`;
            return past.toLocaleDateString();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // --------- Tema escuro ---------
        function createThemeToggle() {
            const themeToggle = document.createElement('div');
            themeToggle.className = 'theme-toggle';
            themeToggle.innerHTML = 'üåì';
            Object.assign(themeToggle.style, {
                position: 'fixed',
                bottom: '20px',
                left: '20px',
                backgroundColor: 'var(--primary)',
                color: 'var(--white)',
                width: '40px',
                height: '40px',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                cursor: 'pointer',
                boxShadow: 'var(--shadow)',
                zIndex: '50'
            });
            themeToggle.addEventListener('click', toggleTheme);
            document.body.appendChild(themeToggle);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            if (document.body.classList.contains('dark-theme')) {
                document.documentElement.style.setProperty('--light-bg', '#1f2937');
                document.documentElement.style.setProperty('--white', '#374151');
                document.documentElement.style.setProperty('--text', '#e5e7eb');
                document.documentElement.style.setProperty('--primary', '#60a5fa');
            } else {
                document.documentElement.style.setProperty('--light-bg', '#f5f7fa');
                document.documentElement.style.setProperty('--white', '#ffffff');
                document.documentElement.style.setProperty('--text', '#333333');
                document.documentElement.style.setProperty('--primary', '#4a6fa5');
            }
        }

        // --------- Autentica√ß√£o ---------
        function updateUserInterface(userData) {
            // Atualizar nome do usu√°rio
            document.querySelectorAll('.user-name').forEach(element => {
                element.textContent = userData.name;
            });
            // Atualizar avatar
            document.querySelectorAll('.avatar, .user-avatar').forEach(element => {
                if (element.tagName === 'DIV') {
                    const initials = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    element.textContent = initials;
                }
            });
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userName');
            window.location.href = '/login.html';
        }

        // --------- Modal de login r√°pido ---------
        function openProfileMenu() {
            document.getElementById('loginModal').style.display = 'flex';
        }
        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }
        function quickLogin() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    if (!email || !password) {
        alert('Por favor, preencha todos os campos');
        return;
    }
    localStorage.setItem('token', 'simulado');
    localStorage.setItem('userName', email.split('@')[0]);
    window.location.href = 'dashboard.html';
}

        // --------- Tabs ---------
        function switchTab(element, tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            // Aqui voc√™ pode carregar conte√∫do din√¢mico se desejar
            console.log(`Switched to ${tabName} tab`);
        }

        // --------- Nova publica√ß√£o ---------
        function createNewPost() {
    const textarea = document.querySelector('.new-post-form textarea');
    const topicsInput = document.querySelector('.new-post-form input');
    const content = textarea.value.trim();
    const topics = topicsInput.value.split(',').map(t => t.trim()).filter(Boolean);

    if (!content) {
        alert('Por favor, escreva algo para publicar.');
        return;
    }

    const postHTML = `
        <div class="post">
            <div class="post-header">
                <div class="post-author-avatar">U</div>
                <div class="post-info">
                    <div class="post-author">Voc√™</div>
                    <div class="post-meta">
                        <span>agora mesmo</span>
                        <span>Personalizado</span>
                    </div>
                </div>
            </div>
            <div class="post-content">
                <p>${content}</p>
                <div class="post-topics">
                    ${topics.map(t => `<span class="post-topic">${t}</span>`).join('')}
                </div>
            </div>
            <div class="post-actions">
                <div class="post-action" onclick="toggleLike(this)">
                    <span>üëç</span>
                    <span>0</span>
                </div>
                <div class="post-action">
                    <span>üí¨</span>
                    <span>0 respostas</span>
                </div>
                <div class="post-action">
                    <span>üîñ</span>
                    <span>Salvar</span>
                </div>
            </div>
        </div>`;

    const container = document.querySelector('.posts-container');
    container.insertAdjacentHTML('afterbegin', postHTML);

    textarea.value = '';
    topicsInput.value = '';
    alert('Publica√ß√£o criada com sucesso!');
}

        // --------- Renderiza√ß√£o din√¢mica (mock) ---------
        // As fun√ß√µes abaixo s√≥ funcionam se MathMasterAPI estiver implementada.
        async function renderPosts(posts) {
            const postsContainer = document.querySelector('.posts-container');
            if (!postsContainer) return;
            const html = posts.map(post => `
                <div class="post-card" data-post-id="${post.id}">
                    <div class="post-header">
                        <div class="user-info">
                            <div class="user-avatar">${post.author.avatar}</div>
                            <div>
                                <h4>${post.author.name}</h4>
                                <span class="post-time">${formatTimeAgo(post.createdAt)}</span>
                            </div>
                        </div>
                        <div class="post-topic">${post.topic}</div>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-footer">
                        <button class="like-btn ${post.liked ? 'active' : ''}" onclick="handleLike('${post.id}')">
                            <span>üëç</span>
                            <span>${post.likes}</span>
                        </button>
                        <button class="comment-btn" onclick="handleComment('${post.id}')">
                            <span>üí¨</span>
                            <span>${post.comments.length}</span>
                        </button>
                        <button class="share-btn" onclick="handleShare('${post.id}')">
                            <span>üîó</span>
                        </button>
                    </div>
                    ${post.comments.length > 0 ? `
                        <div class="comments-section">
                            ${post.comments.map(comment => `
                                <div class="comment">
                                    <div class="comment-avatar">${comment.author.avatar}</div>
                                    <div class="comment-content">
                                        <h5>${comment.author.name}</h5>
                                        <p>${comment.content}</p>
                                        <span class="comment-time">${formatTimeAgo(comment.createdAt)}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
            postsContainer.innerHTML = html;
        }

        async function handleLike(postId) {
            try {
                const response = await MathMasterAPI.Community.likePost(postId);
                if (response.success) {
                    const posts = await MathMasterAPI.Community.getPosts();
                    renderPosts(posts);
                }
            } catch (error) {
                console.error('Erro ao curtir post:', error);
            }
        }
        async function handleComment(postId) {
            const comment = prompt('Digite seu coment√°rio:');
            if (comment) {
                try {
                    await MathMasterAPI.Community.commentPost(postId, comment);
                    const posts = await MathMasterAPI.Community.getPosts();
                    renderPosts(posts);
                } catch (error) {
                    console.error('Erro ao comentar:', error);
                }
            }
        }
        function handleShare(postId) {
            alert('Funcionalidade de compartilhamento em desenvolvimento');
        }

        // --------- Inicializa√ß√£o ---------
        document.addEventListener('DOMContentLoaded', async function () {
            // Verificar autentica√ß√£o
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login.html?redirect=comunidade.html';
                return;
            }
            try {
                // Simular dados do usu√°rio
                const userData = {
                    name: localStorage.getItem('userName') || 'Usu√°rio',
                    email: 'usuario@exemplo.com',
                    id: '123456'
                };
                updateUserInterface(userData);

                // Inicializar notifica√ß√µes se dispon√≠vel
                if (window.NotificationSystem) window.NotificationSystem.init();

                // Tema escuro
                createThemeToggle();

                // Inicializar dados din√¢micos se MathMasterAPI existir
                if (window.MathMasterAPI) {
                    const posts = await MathMasterAPI.Community.getPosts();
                    renderPosts(posts);

                    // Atualiza√ß√£o peri√≥dica dos posts
                    setInterval(async () => {
                        const newPosts = await MathMasterAPI.Community.getPosts();
                        renderPosts(newPosts);
                    }, 60000);
                }

                // Curtidas nos posts est√°ticos (caso n√£o use API)
                document.querySelectorAll('.post-action:first-child').forEach(button => {
                    button.addEventListener('click', function () {
                        const countElement = this.querySelector('span:last-child');
                        let count = parseInt(countElement.textContent);
                        if (this.classList.contains('liked')) {
                            count--;
                            this.classList.remove('liked');
                        } else {
                            count++;
                            this.classList.add('liked');
                        }
                        countElement.textContent = count;
                    });
                });

            } catch (error) {
                console.error('Erro ao processar autentica√ß√£o:', error);
                window.location.href = '/login.html?redirect=comunidade.html';
            }
        });   
     